---
title: 'Assignment 4: LobStars in the Santa Barbara Channel'
author: "Natalie Dornan, Daphne Virlar-Knight"
date: "November 13, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Load packages and read in data

```{r, include=FALSE}

# install.packages("vcdExtra") Natalie installed new package
library(tidyverse)
library(kableExtra)
library(plotly)
library(vcdExtra)

lobstar_abs <- read_csv("lobster_size_abundance.csv") #data frame with lobster abundance datac

lobstar_traps <- as.data.frame(read_csv("lobster_traps.csv")) # data frame with lobster trap data


```

Daphne: Created graphs for question 1, but not sure they're "complete enough".
Natalie: Added abundace summary tables

1. Lobster abundance and fishing pressure
```{r, echo=FALSE}
#-----------------------------------TABLE CREATIONS--------------------------------------
#Describe trends in lobster abundance (counts) and fishing pressure (trap buoys) at the five locations from 2012 - 2017. Ignore transect information - we are only interested in evaluating abundance and pressure on the order of SITE.

#getting rid of transect data, and changing -99999 to 0
lobstar_abs_one <- lobstar_abs %>% 
  select(-SBC_LTER_TRANSECT, -LOBSTER_TRANSECT) %>% 
  mutate(SIZE = replace(SIZE, SIZE==-99999, 0)) %>% 
  group_by(YEAR, SITE) %>% 
  summarize(
    SUM = sum(COUNT)
  )

#### Nice work Daphne! I'll create a new dataframe for potential summary table

lobstar_summary <- lobstar_abs %>% 
  select(-SBC_LTER_TRANSECT, -LOBSTER_TRANSECT) %>% 
  mutate(SIZE = replace(SIZE, SIZE==-99999, 0)) %>% 
  group_by(YEAR, SITE) %>% 
  summarize(
    mean_size = round(mean(SIZE),2),
    median_size = round(median(SIZE),2),
    max_size = round(max(SIZE),2),
    sd_size = round(sd(SIZE),2),
    total_observations = sum(COUNT),
    sample_size = length(SIZE))

## Summary tables by year. A table of all years was too long, so N split them up
##2012

lobstar_sum_table_12 <- lobstar_summary %>%
  filter(YEAR == "2012") %>%
  kable(align = "c", col.names = c("Year", "Site", "Mean", "Median", "Maximum", "Standard Deviation", "# Lobstars Observed", "Sample Size (n)")) %>%
  kable_styling(bootstrap_options = c("striped", "consensed"), full_width = F) %>%
  add_header_above(c("Lobster Abundance at Different Sites in the Santa Barbara Channel, 2012" = 8)) # add header above table columns

lobstar_sum_table_12

##2013

lobstar_sum_table_13 <- lobstar_summary %>%
  filter(YEAR == "2013") %>%
  kable(align = "c", col.names = c("Year", "Site", "Mean", "Median", "Maximum", "Standard Deviation", "# Lobstars Observed", "Sample Size (n)")) %>%
  kable_styling(bootstrap_options = c("striped", "consensed"), full_width = F) %>%
  add_header_above(c("Lobster Abundance at Different Sites in the Santa Barbara Channel, 2013" = 8)) # add header above table columns

lobstar_sum_table_13

##2014

lobstar_sum_table_14 <- lobstar_summary %>%
  filter(YEAR == "2014") %>%
  kable(align = "c", col.names = c("Year", "Site", "Mean", "Median", "Maximum", "Standard Deviation", "# Lobstars Observed", "Sample Size (n)")) %>%
  kable_styling(bootstrap_options = c("striped", "consensed"), full_width = F) %>%
  add_header_above(c("Lobster Abundance at Different Sites in the Santa Barbara Channel, 2014" = 8)) # add header above table columns

lobstar_sum_table_14

##2015

lobstar_sum_table_15 <- lobstar_summary %>%
  filter(YEAR == "2015") %>%
  kable(align = "c", col.names = c("Year", "Site", "Mean", "Median", "Maximum", "Standard Deviation", "# Lobstars Observed", "Sample Size (n)")) %>%
  kable_styling(bootstrap_options = c("striped", "consensed"), full_width = F) %>%
  add_header_above(c("Lobster Abundance at Different Sites in the Santa Barbara Channel, 2015" = 8)) # add header above table columns

lobstar_sum_table_15

##2016

lobstar_sum_table_16 <- lobstar_summary %>%
  filter(YEAR == "2016") %>%
  kable(align = "c", col.names = c("Year", "Site", "Mean", "Median", "Maximum", "Standard Deviation", "# Lobstars Observed", "Sample Size (n)")) %>%
  kable_styling(bootstrap_options = c("striped", "consensed"), full_width = F) %>%
  add_header_above(c("Lobster Abundance at Different Sites in the Santa Barbara Channel, 2016" = 8)) # add header above table columns

lobstar_sum_table_16

##2017

lobstar_sum_table_17 <- lobstar_summary %>%
  filter(YEAR == "2017") %>%
  kable(align = "c", col.names = c("Year", "Site", "Mean", "Median", "Maximum", "Standard Deviation", "# Lobstars Observed", "Sample Size (n)")) %>%
  kable_styling(bootstrap_options = c("striped", "consensed"), full_width = F) %>%
  add_header_above(c("Lobster Abundance at Different Sites in the Santa Barbara Channel, 2017" = 8)) # add header above table columns

lobstar_sum_table_17


#Creating histograms of lobster abundance and fishing pressure by site. Maybe use a kable table to summarize information? Thinking out loud. ND: created tables by year. I think it's helpful, but may want to brainstorm best table visualization.

#the next two graphs show the same data and trend. Just need to decided which we want to use.

```



```{r}

#------------------------------EXPLORATORY DATA ANALYSIS---------------------------------
lobstar_abs_tidy <- lobstar_abs %>% 
  filter(COUNT != "0")


hist <- ggplot(lobstar_abs_tidy, aes(x=SIZE)) +
  geom_histogram() +
  facet_wrap(~ SITE)

qq_plot <- ggplot(lobstar_abs_tidy, aes(sample=SIZE)) +
  geom_qq() +
  facet_wrap(~ SITE)

#everything's fine


```



```{r}
#-----------------------------ABUNDANCE AND TRAP PRESSURE--------------------------------

abs_site_scatter <- ggplot(lobstar_abs_one, aes(x = YEAR, y = SUM)) +
  geom_point() +
  geom_line(aes(col = SITE))+
  ggtitle("Abundance of Lobsters")+
  ylab("Count")+
  theme_classic()

trap_pres_one <- lobstar_traps %>% 
  group_by(YEAR, SITE) %>% 
  summarize(
    SUM = sum(TRAPS)
  ) %>% 
  filter(SITE !="ABUR", SITE != "AHND to AQUE", SITE != "AHND", SITE != "GOLB")

trap_pres_scatter <- ggplot(trap_pres_one, aes(x = YEAR, y = SUM))+
  geom_point()+
  geom_line(aes(col = SITE))+
  theme_classic()+
  ggtitle("Fishing Pressure")+
  ylab("Trap Buoys")

abs_site_scatter; trap_pres_scatter

```

Natalie RE: graphs. I think for time series data using the scatter is a little easier to digest quickly, especially since we will be comparing abundance to pressure. If we were looking at multiple species then the bar graph would be better. Also, maybe for tables we should merge some data to show trap trends by site and year too. Thoughts? 

Daphne RE: graphs. 
        I think merging the data for abundance v traps as a table makes more sense than showing it in a graph. 
        Also, I think for all graphs we should export them and work on them in word or a google doc. Creating a a full on report in markdown sounds like more of a pain than it's worth. 



Question 2:
```{r}
trap_pres_two <- lobstar_traps %>% 
  expand.dft(freq = "TRAPS")


#I think we should use a bar/column graph, and add error bars and the letters indicating what's significant. Just an idea.
size_comparison <- ggplot(trap_pres_two, )


```

